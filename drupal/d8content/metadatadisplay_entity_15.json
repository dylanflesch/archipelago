{
  "data": {
    "attributes": {
      "twig": "{#\r\nUpdated 06/13/2024 for 1.4.0\r\n\r\nUses metadata exposed endpoint Route to generate URL so Aliases don't break it\r\n\r\nThis Template generates IIIF 3.0 API Manifest for Collections using a Drupal Views\r\nJSON to be used by a Drupal Views (REST) to generate a simpler to parse/join listing of Canvases\r\nFor a Collection Manifest Manifest\r\n\r\nStructures passed from Archipelago are\r\n- node\r\n  The full Node entity\r\n- data\r\n  The Full JSON Structure converted in an Array\r\n- iiif_server\r\n  The publicly available IIIF Server (Global Setting)\r\n\r\nSince JSON was decoded into the 'data' values are valid PHP but could not\r\nbe valid JSON when outputting. So We use data.description|json_encode|raw\r\nWithout Double quotes.\r\n#}\r\n{% set Webserverurl =  url('<front>')|render|replace({':8001/':''}) ~ ':8183/iiif/2/' %}\r\n{% set IIIFserverurl = iiif_server ? iiif_server ~ '/': Webserverurl %}\r\n{% set currenturl = url('<current>')|render %}\r\n{% set nodeid = 1 %} \r\n{% if node.id %}\r\n{# this is needed to the View Argument can conform to the format even when no node exists when saving the template #}\r\n  {% set nodeid = node.id %}\r\n  {% set nodeurl = url('entity.node.canonical', {'node': node.id}, {'absolute': true}) %}\r\n{% else %}\r\n  {% set nodeid = 1 %} \r\n  {% set nodeurl = currenturl %}\r\n{% endif%}\r\n{% set len = language.getId() ? language.getId() : \"en\" %}\r\n{% set computed_rights = \"http://rightsstatements.org/vocab/InC-EDU/1.0/\" %}\r\n{% if data.rights|length > 0 or data.rights_statements|length > 0 %}\r\n\t{% if data.rights|length > 0 %} \r\n\t\t{% set computed_rights = data.rights %}\r\n\t{% endif %}\r\n{% elseif data.rights_statements|length > 0 %}\r\n\t{% if data.rights_statements in ['In Copyright'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/InC/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - EU Orphan Work'] %} \r\n    \t{% set computed_rights = \"http://rightsstatements.org/vocab/InC-OW-EU/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - Educational Use Permitted'] %} \r\n\t   \t{% set computed_rights = \"http://rightsstatements.org/vocab/InC-EDU/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - Non-Commercial Use Permitted'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/InC-NC/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['In Copyright - Rights-holder(s) Unlocatable or Unidentifiable'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/InC-RUU/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Copyright - Contractual Restrictions'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/NoC-CR/1.0/\" %}\r\n\t{% endif %} \r\n\t{% if data.rights_statements in ['No Copyright - Non-Commercial Use Only'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/NoC-NC/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Copyright - Other Known Legal Restrictions'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/NoC-OKLR/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Copyright - United States'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/NoC-US/1.0/\" %}\r\n\t{% endif %} \r\n\t{% if data.rights_statements in ['Copyright Not Evaluated'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/CNE/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['Copyright Undetermined'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/UND/1.0/\" %}\r\n\t{% endif %}\r\n\t{% if data.rights_statements in ['No Known Copyright'] %} \r\n\t\t{% set computed_rights = \"http://rightsstatements.org/vocab/NKC/1.0/\" %}\r\n\t{% endif %}\r\n{% endif %}\r\n{\r\n{# Top Object Metadata #}\r\n\"@context\": [\r\n  \"http://www.w3.org/ns/anno.jsonld\",\r\n  \"http://iiif.io/api/presentation/3/context.json\"\r\n],\r\n\"type\": \"Collection\",\r\n\"id\": \"{{ currenturl }}\",\r\n\"label\": {\r\n\"{{ len }}\": [\r\n{{ node.label|json_encode|raw }}\r\n]\r\n},\r\n\"requiredStatement\": {\r\n\"label\": { \"en\": [ \"Attribution\" ] },\r\n\"value\": { \"en\": [ \"Provided by Archipelago Deployment\" ] }\r\n},\r\n\"rights\": {{ computed_rights|json_encode|raw }},\r\n\"metadata\": [\r\n{% for agent in attribute(data, 'edm_agent') %}\r\n    {\r\n    \"label\": {\r\n    \"{{ len }}\": [\r\n    {{ agent.role_label|json_encode|raw }}\r\n    ]\r\n    },\r\n    \"value\": {\r\n    \"{{ len }}\": [\r\n    {{ agent.name_label|json_encode|raw }}\r\n    ]\r\n    }\r\n    },\r\n{% endfor %}\r\n{\r\n\"label\": {\r\n\"{{ len }}\": [\r\n\"description\"\r\n]\r\n},\r\n\"value\": {\r\n\"{{ len }}\": [\r\n{{ data.description|json_encode|raw }}\r\n]\r\n}\r\n},\r\n{\r\n\"label\": {\r\n\"{{ len }}\": [\r\n\"navDate\"\r\n]\r\n},\r\n\"value\":  {\r\n\"{{ len }}\": [\r\n\"{{ node.getChangedTime|date(\"F jS \\\\a\\\\t g:ia\") }}\"\r\n]\r\n}\r\n},\r\n{\r\n\"label\": {\r\n\"{{ len }}\": [\r\n\"license\"\r\n]\r\n},\r\n\"value\": {\r\n\"{{ len }}\": [\r\n{{ computed_rights|json_encode|raw }}\r\n]\r\n}\r\n}\r\n],\r\n{% if attribute(data, 'memberof') %}\r\n    {% set currentnode = 'node/' ~ data.memberof %}\r\n    \"within\": \"{{ url(currentnode) }}\",\r\n{% else %}\r\n    {% set currentnode = '<current>' %}\r\n{% endif %}\r\n{# fetch all children using a View and attach them as Items #}\r\n  \"items\": [\r\n{% set collection_view = drupal_view('data_collection_manifest','children_ismemberof_manifest_rest', nodeid)|render %}\r\n{% set collection_items = collection_view|sbf_json_decode %}\r\n{% for items in collection_items %}\r\n{# canvas|json_encode #}\r\n    {\r\n    {% if 'CreativeWorkSeries' in items['ado_type']|split(',') %}\r\n        \"id\": \"{{ url('format_strawberryfield.metadatadisplay_caster', {'node': items['uuid'],'metadataexposeconfig_entity':'iiifmanifest3cws', \r\n        'format':'default.jsonld'}, {'absolute': true, 'alias': true}) }}\",\r\n        \"type\": \"Manifest\",\r\n     {% elseif 'Collection' in items['ado_type']|split(',') %}\r\n        \"id\": \"{{ url('format_strawberryfield.metadatadisplay_caster', {'node': items['uuid'], 'metadataexposeconfig_entity':'iiifmanifest3collection', \r\n        'format':'default.jsonld'}, {'absolute': true, 'alias': true}) }}\",\r\n        \"type\": \"Collection\",\r\n    {% else %}\r\n         \"id\": \"{{ url('format_strawberryfield.metadatadisplay_caster', {'node': items['uuid'], 'metadataexposeconfig_entity':'iiifmanifest', \r\n        'format':'default.jsonld'}, {'absolute': true, 'alias': true}) }}\",\r\n        \"type\": \"Manifest\",\r\n    {% endif %}\r\n       \"label\": { \"{{len}}\": [ \"{{ items['label'] }}\" ] },\r\n       {{ items['thumbnail']|raw }}\r\n    }\r\n    {{ not loop.last ? ',' : '' }}\r\n{% endfor %}\r\n  ]\r\n}",
      "name": "IIIF Presentation API 3 Collection Manifest",
      "mimetype": "application/ld+json",
      "langcode": "und"
    },
    "id": "9be8473c-3fb3-42ee-aef2-431b2d4f93bb",
    "type": "metadatadisplay_entity--metadatadisplay_entity"
  }
}
